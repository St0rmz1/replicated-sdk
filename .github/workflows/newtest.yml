# workflows/publish-with-slsa.yml
name: 'Publish with Test2'
on:
  workflow_dispatch:  
jobs:
  package-and-publish:
    runs-on: 'ubuntu-22.04'
    outputs:
      image-digest: ${{ steps.fake-build-push-action.outputs.digest }}
      image-name: ${{ steps.fake-build-push-action.outputs.image-name }}
    steps:
      - name: 'Fake build-push-action'
        id: fake-build-push-action
        run: |
          echo "::set-output name=digest::sha256:fake-digest-value"
          echo "::set-output name=image-name::fake-image-name"

  provenance-setup:
    needs:
      - package-and-publish
    runs-on: ubuntu-22.04
    outputs:
      image-name: ${{ needs.package-and-publish.outputs.image-name }}
      image-digest: ${{ needs.package-and-publish.outputs.image-digest }}
    steps:
      - name: Set output variables
        run: |
          echo "IMAGE_NAME=${{ needs.package-and-publish.outputs.image-name }}" >> $GITHUB_ENV
          echo "IMAGE_DIGEST=${{ needs.package-and-publish.outputs.image-digest }}" >> $GITHUB_ENV

  provenance:
    needs:
      - provenance-setup
    uses: slsa-framework/slsa-github-generator/.github/workflows/generator_container_slsa3.yml@v1.10.0
    with:
     image: ${{ env.IMAGE_NAME }}
     digest: ${{ env.IMAGE_DIGEST }}

